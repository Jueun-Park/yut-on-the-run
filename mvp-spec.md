# yut-on-the-run MVP Spec

## 0. 목표
- 웹앱 기반 싱글 플레이 윷놀이 변형 게임.
- 정통 윷판(바깥길 + 대각선 + 중앙)에서 **말 4개를 모두 완주**시키면 클리어.
- 실패 조건 없음. 목표는 **클리어 턴 수 최소화**.
- “덱빌딩”은 카드 대신 **특수 윷가락 4개 슬롯 교체**로 구현(컨텐츠는 MVP 이후 확장 가능).

---

## 1. 핵심 용어
- **턴(Turn)**: 여러 번 던져 결과를 모으고, 모은 결과를 원하는 순서로 소모해 이동을 수행하는 한 사이클.
- **결과 토큰(Hand token)**: 한 번 던져 얻은 결과(도/개/걸/윷/모). 한 턴 동안 모아두었다가 이동 단계에서 1개씩 소비한다.
- **스택(Stack)**: 업기(말 올리기)로 묶인 말 그룹. 스택은 분리 이동 불가(항상 함께 이동).
- **노드(Node)**: 말이 위치할 수 있는 보드의 점. 바깥길 노드 `O0..O20`, 중앙 `C`, 대각선 노드 `A*`, `B*` 등.

---

## 2. 보드(정통 윷판) 모델
### 2.1 노드 구성
- 바깥길: `O0..O20`
  - `O0` = **집(HOME)** 을 의미하는 보드 밖 위치(화면에 표시하지 않아도 됨).
  - `O1..O20` = 바깥길의 실제 칸.
- 중앙: `C`
- 대각선 A (O5 ↔ C ↔ O15)
  - 진입: `O5 -> A1 -> A2 -> C`
  - 출구: `C -> A3 -> A4 -> O15`
- 대각선 B (O10 ↔ C ↔ O20)
  - 진입: `O10 -> B1 -> B2 -> C`
  - 출구: `C -> B3 -> B4 -> O20`

> 참고: 대각선 길이는 “옵션 M”(중앙까지 2칸 + 중앙 이후 2칸)을 사용한다.

### 2.2 분기 규칙(매우 중요)
- **분기 선택은 ‘이동을 시작할 때’만** 발생한다.
- 이동 중에 분기 노드를 “지나가도” 분기 선택은 발생하지 않는다.
- 분기 노드:
  - `O5`: 바깥길 계속 vs 대각선 A 진입
  - `O10`: 바깥길 계속 vs 대각선 B 진입
  - `C`: O15 방향 출구(A3) vs O20 방향 출구(B3)
- **`O15`에서는 분기 불가**(바깥길로만 진행).

### 2.3 완주 규칙
- 완주는 “정확히 맞출 필요 없음”.
- 바깥길의 마지막 칸 `O20`에서 **남은 이동 step이 1 이상이면 즉시 완주(FINISHED)**.
  - 즉, `O20`을 “지나치면” 완주 처리한다.

---

## 3. 말/스택(업기) 규칙
### 3.1 말 개수 및 상태
- 말 4개.
- 각 말은 `HOME(O0)`, `ON_BOARD(nodeId)`, `FINISHED` 중 하나의 상태를 가진다.
- 실제 구현에서는 말이 개별로 움직이지 않고 **스택 단위**로 움직인다.

### 3.2 업기(자동 합치기)
- 이동 후 도착 노드에 다른 스택이 존재하면 **즉시 자동 병합**한다.
- 병합된 스택은 이후 **분리 이동 불가**(항상 함께 이동).

---

## 4. 턴 구조(Throw → Start Move → Play)
### 4.1 턴 페이즈
1) **Throw Phase (던지기 단계)**
- 상태값: `throwsRemaining`(남은 던지기 횟수), `hand`(결과 토큰 목록)
- 턴 시작 시: `throwsRemaining = 1`, `hand = []`
- 플레이어는 `throwsRemaining > 0`인 동안 [던지기] 버튼으로 결과를 획득한다.
- 결과가 **윷 또는 모**이면: `throwsRemaining += 1` (같은 턴에 던질 기회가 증가)
- 던질 기회가 0이 되면 [던지기]는 비활성화되고, **[이동 시작]** 버튼이 활성화된다.

2) **Move Start (이동 시작 버튼)**
- 플레이어가 [이동 시작]을 누르면 Play Phase로 진입한다.

3) **Play Phase (이동 처리 단계)**
- `hand`에 있는 결과 토큰을 **원하는 순서로** 하나씩 선택해 소비한다.
- 토큰 1개를 선택하면:
  - 이동시킬 대상(스택 또는 HOME의 새 말) 선택 → (필요 시) 분기 옵션 선택 → 이동 적용.
- 토큰을 1개 적용할 때마다 hand에서 제거된다.
- `hand`가 비면 턴 종료 → `turn += 1` 후 다음 턴의 Throw Phase로 진행.

4) **Reward Phase (보상 선택 모달)**
- 이동 결과로 말(스택)이 완주하면 보상 선택 단계로 잠시 진입한다.
- 보상 선택이 끝나면 다시 Play Phase로 돌아가 hand의 나머지 토큰을 계속 처리한다.

5) **Game Over**
- 4말 모두 FINISHED이면 즉시 게임 종료.
- 표시: 총 턴 수, 결과 요약(복사 가능).

---

## 5. 이동 규칙(steps 소비)
### 5.1 결과(step) 정의
- 결과는 다음 중 하나: 도(1), 개(2), 걸(3), 윷(4), 모(5)
- **백도는 없음**.

### 5.2 HOME에서의 이동(스폰 포함)
- HOME을 `O0`로 모델링한다.
- `O0 -> O1`이 “보드로 나오는 1 step”이다.
- 따라서:
  - 도(1)을 HOME에서 사용하면 최종 위치는 `O1`.
  - 모(5)을 HOME에서 사용하면 최종 위치는 `O5`.

### 5.3 분기 처리(출발 시점만)
- 이동 시작 노드가 분기 노드(`O5`, `O10`, `C`)이면 플레이어는 “첫 step의 다음 노드”를 선택한다.
- 그 이후 남은 step들은 강제 경로로 자동 진행한다(이동 도중 분기 무시).

---

## 6. 유물(리워드) 규칙 + 업기 디메리트
### 6.1 보상 트리거
- 어떤 이동으로 스택이 완주(FINISHED)하면 유물 보상을 1회 제공한다.

### 6.2 후보 수(업기 디메리트, 옵션 A)
- 완주한 스택에 포함된 말 수를 `k`라고 할 때,
- 유물 후보 수 `n = max(1, 4 - k)`
  - k=1 → 후보 3개 중 1개 선택
  - k=2 → 후보 2개 중 1개 선택
  - k=3 → 후보 1개 중 1개 선택
  - k=4 → 후보 1개 중 1개 선택(또는 추후 밸런스에 따라 0개로 변경 가능)
- 선택한 유물은 즉시 획득/적용된다.

> MVP에서는 유물 효과의 구체 내용은 별도 데이터(content)로 정의하며, 엔진에는 “유물 획득 이벤트”와 “후보 생성 RNG 소비”만 우선 구현한다.

---

## 7. 덱빌딩(특수 윷가락 4슬롯) MVP 범위
- 플레이어는 4개의 “윷가락 슬롯”을 가진다.
- MVP 1차 목표는 “기본 윷 던지기 + 턴/이동/보상 루프” 완성.
- 이후 확장:
  - 특수 윷가락 10+종, 유물 10+종을 데이터 드리븐으로 추가.
  - 시드 기반 RNG로 동일한 시드/선택이면 동일한 런을 재현 가능하게 한다.

---

## 8. UI 최소 요구사항
- 상단: 현재 턴 수
- Throw Phase:
  - `throwsRemaining` 표시
  - [던지기] 버튼
  - `hand` 토큰 표시(누적)
  - [이동 시작] 버튼(throwsRemaining==0일 때 활성)
- Play Phase:
  - `hand` 토큰들을 버튼/칩으로 표시(순서 선택 가능)
  - 이동 대상(스택/집) 선택 UI
  - (필요 시) 분기 옵션 선택 UI
- Reward:
  - 유물 후보 `n`개를 보여주고 1개 선택
- 종료:
  - 클리어 턴 수 및 요약 텍스트, 복사 버튼

---

## 9. 비목표(의도적으로 MVP에서 제외)
- PvP/상대 말 잡기
- 백도
- 분리 이동
- 이동 중 분기 선택(출발 시점 외 분기 금지)
- 중앙에서의 “정통 강제 출구” (MVP에서는 C에서 O15/O20 출구 선택 허용)
- 고급 애니메이션/그래픽(프로토타입 우선)

---

## 10. 테스트 시나리오(간단 체크)
- HOME에서 도(1) 사용 → O1
- HOME에서 모(5) 사용 → O5 (분기 선택 없음, 다음 이동에서 O5 출발 시 분기 가능)
- O5에서 도(1) 사용 시:
  - 바깥길 선택 → O6
  - 대각선 선택 → A1
- C에서 도(1) 사용 시:
  - A3 선택 → A3
  - B3 선택 → B3
- 업기:
  - 스택 X가 어떤 노드에 도착했을 때 다른 스택 Y가 있으면 자동 병합
- 완주:
  - O20에 있고 도(1)을 사용해 한 칸 더 가려 하면 FINISHED
- 보상 후보 수:
  - k=1 완주 → 3개 후보
  - k=2 완주 → 2개 후보
